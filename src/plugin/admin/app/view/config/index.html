<style>
    #configUeditorCheckBox .layui-form-checkbox {
        margin-bottom: 10px;
    }
</style>
<div class="layui-card">
    <div class="layui-card-body">
        <blockquote class="layui-elem-quote">
            全局取值方式： get_config(); 例如，取站点名称：get_config('site_name')
        </blockquote>
        <form class="layui-form" action="javascript:;">
            <div class="layui-tab layui-tab-brief" lay-filter="docDemoTabBrief">
                <ul class="layui-tab-title">
                    <li class="layui-this">基本设置</li>
                    <li>安全设置</li>
                    <li>附件设置</li>
                    <li>UeditorPlus图标</li>
                </ul>
                <div class="layui-tab-content" style="margin-top: 10px;">
                    <!--基本设置-->
                    <div class="layui-tab-item layui-show">
                        <table class="layui-table" width="100%">
                            <thead>
                            <tr>
                                <th width="15%">名称</th>
                                <th>变量值</th>
                                <th width="12%">变量名</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td>站点名称</td>
                                <td>
                                    <input type="text" name="site_name" lay-verify="required"
                                           autocomplete="off" class="layui-input" lay-reqtext="站点名称不能为空">
                                </td>
                                <td>site_name</td>
                            </tr>
                            <tr>
                                <td>站点根网址</td>
                                <td>
                                    <input type="text" name="site_url" value="" lay-verify="url" autocomplete="off"
                                           class="layui-input">
                                </td>
                                <td>site_url</td>
                            </tr>
                            <tr>
                                <td>网站关键词</td>
                                <td>
                                    <input type="text" name="site_keyword" value="" autocomplete="off"
                                           class="layui-input">
                                </td>
                                <td>site_keyword</td>
                            </tr>
                            <tr>
                                <td>网站版权信息</td>
                                <td>
                                    <input type="text" name="site_copyright" value=""
                                           autocomplete="off" class="layui-input">
                                </td>
                                <td>site_copyright</td>
                            </tr>
                            <tr>
                                <td>网站备案号</td>
                                <td>
                                    <input type="text" name="site_beian" value="" autocomplete="off"
                                           class="layui-input">
                                </td>
                                <td>site_beian</td>
                            </tr>
                            <tr>
                                <td>网站描述</td>
                                <td>
                                    <textarea placeholder="统计代码" class="layui-textarea"
                                              name="site_description"></textarea>
                                </td>
                                <td>site_description</td>
                            </tr>
                            <tr>
                                <td>统计代码</td>
                                <td>
                                    <textarea placeholder="统计代码" class="layui-textarea"
                                              name="site_code"></textarea>
                                </td>
                                <td>site_code</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>

                    <!--安全设置-->
                    <div class="layui-tab-item">
                        <table class="layui-table">
                            <thead>
                            <tr>
                                <th width="15%">站点名称</th>
                                <th>变量值</th>
                                <th width="12%">变量名</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td>文本编辑器</td>
                                <td>
                                    <div class="layui-input-inline" style="width:200px">
                                        <select name="site_editor">
                                            <option value="uEditorPlus">uEditorPlus</option>
                                        </select>
                                    </div>
                                </td>
                                <td>site_editor</td>
                            </tr>
                            <tr>
                                <td>启用后台管理操作日志</td>
                                <td>
                                    <input type="radio" name="admin_log" value="1" title="启用">
                                    <input type="radio" name="admin_log" value="0" title="禁用">
                                </td>
                                <td>admin_log</td>
                            </tr>
                            <tr>
                                <td>此ip禁止访问网站</td>
                                <td>
                                    <textarea class="layui-textarea" name="admin_prohibit_ip"
                                              placeholder="匹配IP段用“*”占位，如192.168.*.*，多个IP地址请用英文逗号“,”分割"></textarea>
                                    <div class="layui-form-mid layui-word-aux">匹配IP段用“*”占位多个IP用“,”分割</div>
                                </td>
                                <td>admin_prohibit_ip</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>

                    <!--附件设置-->
                    <div class="layui-tab-item">
                        <table class="layui-table">
                            <thead>
                            <tr>
                                <th width="15%">站点名称</th>
                                <th>变量值</th>
                                <th width="12%">变量名</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td>允许上传图片类型</td>
                                <td>
                                    <input type="text" name="upload_types_image" value=""
                                           autocomplete="off" class="layui-input">
                                </td>
                                <td>upload_types_image</td>
                            </tr>
                            <tr>
                                <td>允许上传附件类型</td>
                                <td>
                                    <input type="text" name="upload_types_file" value=""
                                           autocomplete="off" class="layui-input">
                                </td>
                                <td>upload_types_file</td>
                            </tr>
                            <tr>
                                <td>多图上传图片数量限制</td>
                                <td>
                                    <div class="layui-input-inline">
                                        <input type="number" name="pic_more_nums" value=""
                                               autocomplete="off" class="layui-input">
                                    </div>
                                    <span style="margin-left:10px; color:#f00">[0 为不限制]</span>
                                </td>
                                <td>pic_more_nums</td>
                            </tr>
                            <tr>
                                <td>保存方式</td>
                                <td>
                                    <div class="layui-input-inline">
                                        <select name="upload_mode" lay-filter="upload_mode">
                                            <option value="local">本地保存</option>
                                            <option value="oss">阿里云 OSS</option>
                                            <option value="qiniu">七牛云</option>
                                            <option value="s3">S3</option>
                                            <option value="cos">腾讯云 COS</option>
                                            <option value="obs">华为云 OBS</option>
                                        </select>
                                    </div>
                                    <br><span
                                        style="color:#ff00ea">[非“本地保存”，请在配置文件里对密钥等信息进行配置 <span
                                        style="font-weight: bold;color:#ff6a00">(config/plugin/yzh52521/filesystem/app.php)</span>，否则上传失败]</span>
                                </td>
                                <td>upload_mode</td>
                            </tr>
                            <tr>
                                <td>是否开启图片水印</td>
                                <td>
                                    <input type="radio" name="watermark_enable" value="1" title="开启">
                                    <input type="radio" name="watermark_enable" value="0" title="关闭">
                                    <span style="margin-left:10px; color:#ff00dd">[水印仅对【本地保存】有效]</span>
                                </td>
                                <td>watermark_enable</td>
                            </tr>
                            <tr>
                                <td>水印图片名称</td>
                                <td>
                                    <div class="layui-input-inline">
                                        <input type="text" name="watermark_name" value="" autocomplete="off"
                                               class="layui-input">
                                        <tip>[水印存放路径:public/static/water]</tip>
                                    </div>
                                </td>
                                <td>watermark_name</td>
                            </tr>
                            <tr>
                                <td>水印的位置</td>
                                <td>
                                    <input type="radio" name="watermark_position" value="1" title="顶部居左">
                                    <input type="radio" name="watermark_position" value="2" title="顶部居中">
                                    <input type="radio" name="watermark_position" value="3" title="顶部居右">
                                    <input type="radio" name="watermark_position" value="4" title="中部居左">
                                    <input type="radio" name="watermark_position" value="5" title="中部居中">
                                    <input type="radio" name="watermark_position" value="6" title="中部居右">
                                    <input type="radio" name="watermark_position" value="7" title="顶部居左">
                                    <input type="radio" name="watermark_position" value="8" title="底部居中">
                                    <input type="radio" name="watermark_position" value="9" title="底部居右">
                                </td>
                                <td>watermark_position</td>
                            </tr>
                            <tr>
                                <td>水印透明度</td>
                                <td>
                                    <div class="layui-input-inline" style="width:65%;margin:18px 0;">
                                        <div id="configSlideWaterMark" class="demo-slider"></div>
                                        <input type="hidden" name="watermark_touming">
                                    </div>
                                    <div class="layui-form-mid layui-word-aux">[水印透明度设置]</div>
                                </td>
                                <td>watermark_touming</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>

                    <!--UeditorPlus图标-->
                    <div class="layui-tab-item">
                        <table class="layui-table">
                            <thead>
                            <tr>
                                <th width="15%">站点名称</th>
                                <th>变量值</th>
                                <th width="12%">变量名</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td>&emsp;请勾选要启用的图标<br>【全选或不选显示全部】</td>
                                <td id="configUeditorCheckBox"></td>
                                <td>ueditor_icon</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="layui-form-item ">
                <label class="layui-form-label"></label>
                <div class="layui-input-inline" style="width: 80%">
                    <input class="layui-btn" type="submit" value="立即保存" lay-submit="" lay-filter="data-save">
                    <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                </div>
            </div>
        </form>
    </div>
</div>
<script>

  layui.use(['table', 'form', 'util'], function () {
    var $ = layui.jquery;
    var form = layui.form;
    var table = layui.table;
    var util = layui.util;
    form.render();
    valueUeditorIcon = '';
    $.ajax({
      url: "/app/admin/config/select?limit=5000",
      dataType: "json",
      method: "GET",
      success: function (res) {
        // 给表单初始化数据
        layui.each(res.data, function (key, value) {
          let obj = $('*[name="' + value.name + '"]');
          if (value.name === 'ueditor_icon') {
            window.valueUeditorIcon = value.value;
          }
          if (typeof obj[0] === "undefined" || !obj[0].nodeName) return;
          if (obj[0].type === 'textarea') {
            //文本输入框
            obj.val(layui.util.escape(value.value));
          } else if (obj[0].type === 'radio') {
            //单选按钮
            layui.$("input[name=" + value.name + "][value=" + value.value + "]").attr("checked", true);
          } else {
            if (obj[0].nodeName.toLowerCase() === 'select') {
              //下拉
              layui.$("select[name=" + value.name + "]").val(value.value);
            } else {
              //其他
              obj.attr("value", value.value);
            }
          }
        });

        //滑块：水印透明度
        layui.use(["slider"], function () {
          var slider = layui.slider;
          let valueWaterMark = layui.$("input[name='watermark_touming']").attr("value");
          slider.render({
            elem: '#configSlideWaterMark',
            value: valueWaterMark,
            input: true,
            theme: 'var(--global-primary-color)'
          });
        });

        //ueditor编辑器图标
        layui.$.ajax({
          url: '/app/admin/config/index',
          type: "GET",
          dateType: "json",
          data: {type: 'editor_icon'},
          success: function (res) {
            var str = '';
            layui.each(res.data, function (index, item) {
              if (layui.$.inArray(index, valueUeditorIcon) != -1) {
                str += '<input type="checkbox" name="ueditor_icon[]" value="' + index + '" title="' + item + '" checked>\n';
              } else {
                str += '<input type="checkbox" name="ueditor_icon[]" value="' + index + '" title="' + item + '">\n';
              }
            });
            layui.$('#configUeditorCheckBox').html(str);
            form.render();
          }
        })

        form.render();
      }
    });

    //保存数据
    layui.form.on("submit(data-save)", function (data) {
      layui.$.ajax({
        url: '/app/admin/config/edit',
        type: "POST",
        dateType: "json",
        data: data.field,
        success: function (res) {
          if (res.code !== 200) {
            layui.popup.failure(res.msg);
          }
          layui.popup.success(res.msg);
        }
      });
      return false;
    })

  });
</script>
